/*
 * MikroChat version 2.0.0
 * Bundle generated on 2026-02-08T16:52:46.030Z
 */
"use strict";(()=>{var Oo=Object.defineProperty;var w=(e,t)=>()=>(e&&(t=e(e=0)),t);var S=(e,t)=>{for(var n in t)Oo(e,n,{get:t[n],enumerable:!0})};var ee,ca=w(()=>{"use strict";ee=class extends Map{constructor(t){super(),this.maxSize=t}get(t){if(!super.has(t))return;let n=super.get(t);return super.delete(t),super.set(t,n),n}set(t,n){if(super.has(t)&&super.delete(t),super.set(t,n),super.size>this.maxSize){let a=super.keys().next().value;super.delete(a)}return this}}});var r,E=w(()=>{"use strict";ca();r={currentChannelForEdit:null,currentUser:null,currentChannelId:null,messageEventSource:null,currentMessageForReaction:null,currentMessageForReactionIsDM:!1,currentMessageForEdit:null,currentMessageForEditIsDM:!1,currentMessageForEditContent:"",currentMessageForEditImages:[],isStorageInitialized:!1,pendingUploads:[],tempIdMap:new Map,messageCache:new ee(2e3),unreadCounts:new Map,storage:null,currentConversationId:null,conversationCache:new ee(200),dmMessageCache:new ee(2e3),dmUnreadCounts:new Map,viewMode:"channel",currentThreadId:null,threadMessageCache:new ee(500),threadPanelOpen:!1,currentMessageForEditIsThread:!1,isOffline:typeof navigator<"u"?!navigator.onLine:!1}});var ot,Vt,rt,Yt,da,Kt,Jt,fe,te,la,ua,ma,pa,ga,fa,Xt,Zt,G,ha,Qt,ne,ae,en,tn,he,A,ya,Ae,$,oe,wa,q,va,nn,L,Ea,Ia,H,p,_r,D,an,st,ye,it,on,ct,R,dt,$e,De,Re,rn,sn,lt,cn,xa,ut,mt,Ca,dn,we,ln,ka,pt,ve,gt,Ee,Ie,Ma,Pe,Sa,Ne,ba,re,ft,La,Ta,Ba,se,Fe,Ua,Aa,$a,qr,M=w(()=>{"use strict";ot=document.getElementById("add-email-input"),Vt=document.getElementById("add-user-password-group"),rt=document.getElementById("add-user-password-input"),Yt=document.getElementById("add-user-btn"),da=document.getElementById("add-channel-btn"),Kt=document.getElementById("app-container"),Jt=document.getElementById("auth-container"),fe=document.getElementById("channel-name"),te=document.getElementById("channels-list"),la=document.getElementById("close-channel-modal"),ua=document.getElementById("close-edit-channel-modal"),ma=document.getElementById("close-edit-modal"),pa=document.getElementById("close-reaction-modal"),ga=document.getElementById("close-image-preview"),fa=document.getElementById("close-server-settings-modal"),Xt=document.getElementById("create-channel-modal"),Zt=document.getElementById("create-channel-submit"),G=document.getElementById("current-channel-name"),ha=document.getElementById("delete-channel-btn"),Qt=document.getElementById("edit-channel-modal"),ne=document.getElementById("edit-channel-name"),ae=document.getElementById("edit-message-input"),en=document.getElementById("edit-message-modal"),tn=document.getElementById("edit-message-submit"),he=document.getElementById("auth-form-email"),A=document.getElementById("auth-email"),ya=document.getElementById("reaction-picker"),Ae=document.getElementById("reaction-picker-modal"),$=document.getElementById("auth-form-encryption"),oe=document.getElementById("encryption-password"),wa=document.getElementById("exit-server-btn"),q=document.getElementById("image-preview-modal"),va=document.getElementById("image-upload"),nn=document.getElementById("loading"),L=document.getElementById("login-btn"),Ea=document.getElementById("logout-btn"),Ia=document.getElementById("menu-toggle"),H=document.getElementById("message-input"),p=document.getElementById("messages-area"),_r=document.getElementById("password"),D=document.getElementById("preview-image"),an=document.getElementById("send-button"),st=document.getElementById("server-name"),ye=document.getElementById("server-name-input"),it=document.querySelector(".server-name-text"),on=document.getElementById("server-settings-modal"),ct=document.getElementById("sidebar"),R=document.getElementById("auth-form-text"),dt=document.getElementById("theme-switch"),$e=dt?.querySelector(".theme-switch-icon"),De=dt?.querySelector(".theme-switch-label"),Re=document.getElementById("toast"),rn=document.getElementById("update-channel-submit"),sn=document.getElementById("update-server-name-btn"),lt=document.getElementById("user-avatar"),cn=document.getElementById("user-dropdown"),xa=document.getElementById("user-menu"),ut=document.getElementById("users-list"),mt=document.getElementById("user-name"),Ca=document.getElementById("user-settings-btn"),dn=document.getElementById("user-settings-modal"),we=document.getElementById("user-settings-name"),ln=document.getElementById("user-settings-save-btn"),ka=document.getElementById("close-user-settings-btn"),pt=document.getElementById("auth-password"),ve=document.getElementById("auth-form-password-confirm"),gt=document.getElementById("auth-password-confirm"),Ee=document.getElementById("auth-form-password"),Ie=document.getElementById("auth-toggle"),Ma=document.getElementById("auth-toggle-link"),Pe=document.getElementById("dm-list"),Sa=document.getElementById("start-dm-btn"),Ne=document.getElementById("start-dm-modal"),ba=document.getElementById("close-start-dm-modal"),re=document.getElementById("dm-user-list"),ft=document.getElementById("auth-forgot-password"),La=document.getElementById("auth-forgot-password-link"),Ta=document.getElementById("password-reset-sent-form"),Ba=document.getElementById("password-reset-sent-message"),se=document.getElementById("oauth-providers"),Fe=document.getElementById("auth-divider"),Ua=document.getElementById("add-webhook-btn"),Aa=document.getElementById("webhook-name-input"),$a=document.getElementById("webhook-channel-select"),qr=document.getElementById("webhooks-list")});var x,z,V,T=w(()=>{"use strict";x="password",z="http://localhost:3000",V="$J2Ek<wp5Wsp+x!FsGb["});var Da={};S(Da,{findMessageWithId:()=>xe,formatDate:()=>ht,formatTime:()=>Ce,getInitials:()=>k,getReactionsContainer:()=>yt,hasUserReactedWithEmoji:()=>_e,isValidEmail:()=>un,parseMarkdown:()=>Oe,sanitizeInput:()=>mn});function k(e){return e?e.split(" ").map(t=>t.charAt(0)).join("").toUpperCase():"?"}function ht(e){return(e instanceof Date?e:new Date(e)).toLocaleDateString()}function Ce(e){return(e instanceof Date?e:new Date(e)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function un(e){if(!e||typeof e!="string"||(e=e.trim(),e==="")||e.includes(" ")||e.includes(".."))return!1;let t=e.indexOf("@");if(t===-1)return!1;let n=e.slice(0,t),a=e.slice(t+1);if(n.length===0||a.length===0||!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+$/.test(n))return!1;let s=a.split(".");if(s.length<2)return!1;let i=s[s.length-1];if(i.length<2||!/^[a-zA-Z]+$/.test(i))return!1;for(let c of s)if(c.length===0||!/^[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/.test(c))return!1;return!0}function mn(e){return typeof e!="string"?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function Oe(e){if(!e)return"";let t=e;return t=t.replace(/```([\s\S]*?)```/g,function(n,a){return`<pre><code>${a.trim()}</code></pre>`}),t=t.replace(/(\*\*|__)(.*?)\1/g,"<strong>$2</strong>"),t=t.replace(/(\*|_)(?!\*|_)(.*?)\1/g,"<em>$2</em>"),t=t.replace(/(?:^|\n)((?:(?:- |\* ).*(?:\n|$))+)/gm,function(n,a){let o=a.split(/\n(?=(?:- |\* ))/),s="<ul>";for(let i of o)if(i.trim()){let c=i.replace(/^(?:- |\* )/,"").trim();s+=`<li>${c}</li>`}return s+="</ul>",s}),t=t.replace(/(?:^|\n)((?:(?:\d+\. ).*(?:\n|$))+)/gm,function(n,a){let o=a.split(/\n(?=(?:\d+\. ))/),s="<ol>";for(let i of o)if(i.trim()){let c=i.replace(/^\d+\. /,"").trim();s+=`<li>${c}</li>`}return s+="</ol>",s}),t}function xe(e){return Array.from(document.querySelectorAll(".message")).find(n=>n.dataset.id===e)}function _e(e,t){let n=yt(e);return n?Array.from(n.querySelectorAll(".user-reacted")).map(o=>o.dataset.reaction).some(o=>o===t):!1}function yt(e){let t=null;if(t=xe(e),!t){for(let[a,o]of r.tempIdMap.entries())if(o===e&&(t=xe(a),t))break}if(!t)return null;let n=t.querySelector(".message-reactions");return n||null}var B=w(()=>{"use strict";E()});async function ie(e){let t=e||V;!1;try{if(!!1)return!1,await ke(t,!0),!0;if(pn())try{return await ke(t,!1),await r.storage.getItem(qe)==="true"}catch(a){return console.error("Failed to decrypt existing data with provided password:",a),!1}else return!1,await ke(t,!0),await r.storage.setItem(qe,"true"),!0}catch(n){return console.error("Failed to initialize storage:",n),!1}}async function ke(e,t=!0){let n=await new MikroSafe(e);r.storage=n,r.isStorageInitialized=!0,t&&await r.storage.setItem(qe,"true")}function pn(){let e=Object.keys(localStorage),t=e.includes(qe),n=e.includes("token")||e.includes("accessToken");return t&&n}async function Ra(e){try{return await ie(e)?await r.storage.getItem(qe)==="true":!1}catch(t){return console.error("Error verifying encryption password:",t),!1}}var qe,He=w(()=>{"use strict";E();T();qe="_storage_initialized_"});function j(){let e=new URLSearchParams(window.location.search),t=e.get("email"),n=e.get("token"),a=e.get("reset")==="true"||window.location.pathname==="/reset";return{emailParam:t,tokenParam:n,resetParam:a}}var vt=w(()=>{"use strict"});function Y(){let{emailParam:e,tokenParam:t}=j();return e&&t}async function Pa(){try{let{emailParam:e,tokenParam:t}=j();if(!e||!t)return!1;let n=await Na({email:e,token:t}),{accessToken:a,refreshToken:o}=n;return await r.storage.setItem("accessToken",a),await r.storage.setItem("refreshToken",o),!0}catch(e){return console.log("Magic link verification error:",e),!1}}var Et=w(()=>{"use strict";E();vt();N()});async function It(e){e?(document.body.classList.remove("light-mode"),$e&&($e.textContent="\u{1F319}"),De&&(De.textContent="Dark Mode")):(document.body.classList.add("light-mode"),$e&&($e.textContent="\u2600\uFE0F"),De&&(De.textContent="Light Mode")),await r.storage.setItem("darkMode",e?"true":"false")}var gn=w(()=>{"use strict";E();M()});var Ha={};S(Ha,{convertBlobToBase64:()=>Ct,formatFileSize:()=>fn,generateFileHash:()=>_a,generateThumbnail:()=>Oa,handleAddImages:()=>xt,hashSimple:()=>qa,openImagePreview:()=>hn,removePendingUpload:()=>_o,resizeAndCompressImage:()=>Fa});async function xt(e){for(let t of e){if(!t.type.match("image.*")){d("Only image files are supported","error");continue}try{let n=await _a(t);if(r.pendingUploads.some(l=>l.fileHash===n)){d("This image is already in your pending uploads","info");continue}let o=await Fa(t),s=await Oa(o.blob),i=Date.now(),c=t.name.split(".").pop().toLowerCase(),u=`${i}.${c}`;!1,r.pendingUploads.push({fileName:u,fileHash:n,blob:o.blob,thumbnailBlob:s,preview:URL.createObjectURL(o.blob)}),Me()}catch(n){console.error("Error processing image:",n),d("Failed to process image","error")}}}function _o(e){URL.revokeObjectURL(r.pendingUploads[e].preview),r.pendingUploads.splice(e,1),Me()}function Fa(e){return new Promise((t,n)=>{!1;let a=new FileReader;a.onload=function(o){let s=new Image;s.onload=function(){let i=s.width,c=s.height,u=`${i}x${c}`,l=i,g=c,h=1200;l>g&&l>h?(g=Math.round(g*h/l),l=h):g>h&&(l=Math.round(l*h/g),g=h);let I=i!==l||c!==g,O=document.createElement("canvas");O.width=l,O.height=g,O.getContext("2d").drawImage(s,0,0,l,g);let _=.7,pe=e.type,nt=e.name.split(".").pop().toLowerCase();nt==="png"?(pe="image/png",_=.8):nt==="jpg"||nt==="jpeg"?(pe="image/jpeg",_=.7):nt==="webp"&&(pe="image/webp",_=.75),O.toBlob(ge=>{if(ge)if(ge.size>=e.size&&!I){!1;let at={blob:e,originalSize:e.size,newSize:e.size,compressionRatio:0,originalDimensions:u,newDimensions:u,usedOriginal:!0};t(at)}else{let at=((1-ge.size/e.size)*100).toFixed(2);!1;let Fo={blob:ge,originalSize:e.size,newSize:ge.size,compressionRatio:Number.parseFloat(at),originalDimensions:u,newDimensions:`${l}x${g}`,usedOriginal:!1};t(Fo)}else n(new Error("Failed to create image blob"))},pe,_)},s.onerror=function(){n(new Error("Failed to load image"))},s.src=o.target.result},a.onerror=function(){n(new Error("Failed to read file"))},a.readAsDataURL(e)})}function Oa(e){return new Promise((t,n)=>{let a=URL.createObjectURL(e),o=new Image;o.onload=function(){URL.revokeObjectURL(a);let s=o.width,i=o.height,c=400;s>i&&s>c?(i=Math.round(i*c/s),s=c):i>c&&(s=Math.round(s*c/i),i=c);let u=document.createElement("canvas");u.width=s,u.height=i,u.getContext("2d").drawImage(o,0,0,s,i),u.toBlob(g=>{g?t(g):n(new Error("Failed to create thumbnail"))},"image/jpeg",.6)},o.onerror=()=>{URL.revokeObjectURL(a),n(new Error("Failed to load image for thumbnail"))},o.src=a})}function fn(e){return e<1024?`${e} bytes`:e<1048576?`${(e/1024).toFixed(2)} KB`:`${(e/1048576).toFixed(2)} MB`}function Ct(e){return new Promise((t,n)=>{let a=new FileReader;a.onloadend=()=>{let o=a.result.split(",")[1];t(o)},a.onerror=n,a.readAsDataURL(e)})}async function _a(e){return new Promise(t=>{let n=new FileReader;n.onload=a=>{let o=a.target.result,s=qa(o);t(s)},n.readAsArrayBuffer(e)})}function qa(e){let t=new DataView(e),n=0,a=Math.max(1,Math.floor(e.byteLength/1e3));for(let o=0;o<e.byteLength;o+=a){let s=o+3<e.byteLength?t.getUint32(o):t.getUint8(o);n=(n<<5)-n+s,n|=0}return n.toString(16)}async function hn(e){D.src="",q.classList.add("active"),D.style.display="none";let t=document.createElement("div");t.className="loading-spinner",q.querySelector(".image-preview-container").appendChild(t),await b().then(n=>{fetch(e,{method:"GET",headers:{Authorization:`Bearer ${n}`}}).then(a=>{if(!a.ok)throw new Error("Image fetch failed");return a.blob()}).then(a=>{let o=URL.createObjectURL(a);D.src=o,D.style.display="block";let s=q.querySelector(".loading-spinner");s&&s.remove(),D.setAttribute("data-object-url",o)}).catch(a=>{console.error("Error fetching preview image:",a),D.style.display="none",q.querySelector(".image-preview-container").innerHTML='<div class="image-error">Failed to load image</div>'})})}var kt=w(()=>{"use strict";E();M();T();y();N()});var za={};S(za,{addReaction:()=>bt,processReactions:()=>yn,removeReaction:()=>wn,updateReactionInUI:()=>K});function yn(e){let t={};if(!e)return t;for(let[n,a]of Object.entries(e)){if(!a)return;for(let o of a)t[o]||(t[o]=[]),t[o].push(n)}return t}async function bt(e,t){let n=Le(e);if(!n){d("Invalid message ID","error");return}if(!_e(e,t))try{if(r.messageCache.has(e)){let a=r.messageCache.get(e);a.reactions||(a.reactions={}),a.reactions[t]?a.reactions[t].includes(r.currentUser.id)||a.reactions[t].push(r.currentUser.id):a.reactions[t]=[r.currentUser.id],r.messageCache.set(e,a)}await m(`/messages/${n}/reactions`,"POST",{reaction:t}),await K(e,t,!0,!1),Ae.classList.remove("active")}catch(a){await K(e,t,!1,!1),d(a.message||"Failed to add reaction","error")}}async function wn(e,t){let n=Le(e);if(!n){d("Invalid message ID","error");return}try{await m(`/messages/${n}/reactions`,"DELETE",{reaction:t}),await K(e,t,!1,!1)}catch(a){await K(e,t,!0,!1),d(a.message||"Failed to remove reaction","error")}}async function K(e,t,n,a=!1){let o=qo(e);if(!o)return;let s=o.querySelector(`.reaction[data-reaction="${t}"]`),i=Mt(s);if(a){n?s?Se(s,i+1):await be(e,t,1,!1):s&&(Mt(s)-1>=1?Se(s,i-1):s.remove());return}n?s?(Se(s,i+1),St(s,n)):await be(e,t,1,!0):s&&(i>1?(Se(s,i-1),St(s,n)):s.remove())}function qo(e){let t=null;if(t=xe(e),!t){for(let[a,o]of r.tempIdMap.entries())if(o===e&&(t=xe(a),t))break}if(!t)return;let n=t.querySelector(".message-reactions");if(n)return n}var ze=w(()=>{"use strict";E();M();v();y();B();J()});var Ja={};S(Ja,{appendDMMessage:()=>xn,deleteDMMessage:()=>In,loadDMMessagesForConversation:()=>Lt,removeDMMessageFromView:()=>kn,renderDMMessage:()=>Ka,renderDMMessages:()=>Ga,sendDMMessage:()=>Wo,updateDMMessage:()=>Bt,updateDMMessageInView:()=>Cn,uploadDMImage:()=>Go});async function Lt(e,t){if(p)try{let n=`/conversations/${e}/messages?limit=${ja}`;t&&(n+=`&before=${t}`);let o=(await m(n)).messages||[];if(!t)r.dmMessageCache.set(e,o),Ga(o);else{let s=r.dmMessageCache.get(e)||[];r.dmMessageCache.set(e,[...o,...s]),Ho(o)}o.length>=ja?zo(e,o[0].id):En()}catch(n){console.error("Failed to load DM messages:",n),t||(p.innerHTML='<div class="empty-state"><div class="empty-state-icon">!</div><h3>Failed to load messages</h3></div>')}}function Ho(e){if(!p||e.length===0)return;En();let t=Va(e),n=Object.keys(t).sort((a,o)=>{let s=t[a][0].createdAt,i=t[o][0].createdAt;return s-i});for(let a of n){let o=t[a];if(!Array.from(p.querySelectorAll(".message-date-divider")).find(i=>i.textContent===a)){let i=document.createElement("div");i.className="message-date-divider",i.textContent=a,p.appendChild(i)}for(let i of o){let c=Tt(i);p.appendChild(c)}}}function zo(e,t){En();let n=document.createElement("button");n.className="load-more-btn",n.id="load-more-dm-messages",n.textContent="Load older messages",n.addEventListener("click",async()=>{vn||(vn=!0,n.textContent="Loading...",await Lt(e,t),vn=!1)}),p.appendChild(n)}function En(){let e=document.getElementById("load-more-dm-messages");e&&e.remove()}function Tt(e){let t=document.createElement("div");return t.innerHTML=Ka(e),t.firstElementChild}function Ga(e){if(!p)return;if(e.length===0){p.innerHTML=`
      <div class="empty-state">
        <div class="empty-state-icon">@</div>
        <h3>Start the conversation</h3>
        <p>Send a message to start chatting</p>
      </div>
    `;return}p.innerHTML="";let t=Va(e),n=Object.keys(t).sort((a,o)=>{let s=t[a][0].createdAt;return t[o][0].createdAt-s});for(let a of n){let o=document.createElement("div");o.className="message-date-divider",o.textContent=a,p.appendChild(o);let s=t[a];for(let i of s){let c=Tt(i);p.prepend(c)}}Ut()}function Va(e){let t={};for(let n of e){let a=new Date(n.createdAt),o=Ya(a);t[o]||(t[o]=[]),t[o].push(n)}return t}function Ya(e){let t=new Date,n=new Date(t);return n.setDate(n.getDate()-1),e.toDateString()===t.toDateString()?"Today":e.toDateString()===n.toDateString()?"Yesterday":e.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}function Ka(e){let t=e.author.id===r.currentUser?.id,n=k(e.author.userName),a=Ge(e.createdAt),o=We(e.content),s="";if(e.images&&e.images.length>0){s='<div class="message-images-container">';for(let u of e.images)s+=`
        <div class="message-image-container">
          <div class="image-wrapper">
            ${t?`<span class="remove-image-btn" data-message-id="${e.id}" data-image="${u}">&times;</span>`:""}
            <img src="/conversations/${r.currentConversationId}/messages/image/${u}?size=thumb" alt="Image" class="message-image" loading="lazy" data-image="${u}">
          </div>
        </div>
      `;s+="</div>"}let i=jo(e),c="";return t&&(c=`
      <div class="message-actions">
        <button class="message-edit" data-message-id="${e.id}" data-is-dm="true">Edit</button>
        <button class="message-delete" data-message-id="${e.id}" data-is-dm="true">Delete</button>
      </div>
    `),`
    <div class="message" data-id="${e.id}" data-is-dm="true">
      <div class="message-avatar">${n}</div>
      <div class="message-content">
        <div class="message-header">
          <span class="message-author">${e.author.userName}</span>
          <span class="message-time">${a}</span>
        </div>
        <div class="message-text">${o}</div>
        ${s}
        ${i}
        ${c}
      </div>
    </div>
  `}function jo(e){if(!e.reactions||Object.keys(e.reactions).length===0)return`
      <div class="message-reactions">
        <div class="add-reaction" data-message-id="${e.id}">+</div>
      </div>
    `;let t={},n={};for(let[o,s]of Object.entries(e.reactions))for(let i of s)t[i]||(t[i]=0,n[i]=[]),t[i]++,n[i].push(o);let a='<div class="message-reactions">';for(let[o,s]of Object.entries(t)){let i=n[o].includes(r.currentUser?.id);a+=`
      <div class="reaction ${i?"user-reacted":""}"
           data-message-id="${e.id}"
           data-reaction="${o}">
        <span class="reaction-emoji">${o}</span>
        <span class="reaction-count">${s}</span>
      </div>
    `}return a+=`<div class="add-reaction" data-message-id="${e.id}">+</div>`,a+="</div>",a}async function Wo(e,t=[]){if(r.currentConversationId)try{let n=await m(`/conversations/${r.currentConversationId}/messages`,"POST",{content:e,images:t});H&&(H.value="",H.style.height="auto"),r.pendingUploads=[];let a=document.getElementById("pending-uploads-container"),o=document.getElementById("pending-uploads");return a&&(a.style.display="none"),o&&(o.innerHTML=""),n.message}catch(n){throw console.error("Failed to send DM:",n),d(n.message||"Failed to send message","error"),n}}async function Go(e){if(!r.currentConversationId)return null;try{let t=await Wa(e.blob),n={filename:e.name,image:t};return e.thumbnailBlob&&(n.thumbnail=await Wa(e.thumbnailBlob)),(await m(`/conversations/${r.currentConversationId}/messages/image`,"POST",n)).filename}catch(t){return console.error("Failed to upload DM image:",t),d("Failed to upload image","error"),null}}function Wa(e){return new Promise((t,n)=>{let a=new FileReader;a.onload=()=>{let o=a.result.split(",")[1];t(o)},a.onerror=n,a.readAsDataURL(e)})}async function In(e){if(r.currentConversationId)try{await m(`/conversations/${r.currentConversationId}/messages/${e}`,"DELETE"),d("Message deleted","success")}catch(t){console.error("Failed to delete DM:",t),d(t.message||"Failed to delete message","error")}}async function Bt(e,t,n){if(r.currentConversationId)try{let a=await m(`/conversations/${r.currentConversationId}/messages/${e}`,"PUT",{content:t,images:n});return d("Message updated","success"),a.message}catch(a){throw console.error("Failed to update DM:",a),d(a.message||"Failed to update message","error"),a}}function xn(e){if(!p||r.viewMode!=="dm"||r.currentConversationId!==e.channelId||p.querySelector(`.message[data-id="${e.id}"]`))return;let n=r.dmMessageCache.get(e.channelId)||[];n.push(e),r.dmMessageCache.set(e.channelId,n),p.querySelector(".empty-state")&&(p.innerHTML="");let o=Ya(new Date),s=p.querySelector(".message-date-divider");if(!s||s.textContent!==o){let c=document.createElement("div");c.className="message-date-divider",c.textContent=o,p.insertBefore(c,p.firstChild)}let i=Tt(e);p.insertBefore(i,p.firstChild),Ut()}function Cn(e){if(!p||r.viewMode!=="dm"||r.currentConversationId!==e.channelId)return;let t=p.querySelector(`.message[data-id="${e.id}"]`);if(!t)return;let n=r.dmMessageCache.get(e.channelId)||[],a=n.findIndex(o=>o.id===e.id);a!==-1&&(n[a]=e,r.dmMessageCache.set(e.channelId,n)),t.replaceWith(Tt(e))}function kn(e,t){if(!p||r.viewMode!=="dm"||r.currentConversationId!==t)return;let n=p.querySelector(`.message[data-id="${e}"]`);n&&n.remove();let o=(r.dmMessageCache.get(t)||[]).filter(s=>s.id!==e);r.dmMessageCache.set(t,o),o.length===0&&(p.innerHTML=`
      <div class="empty-state">
        <div class="empty-state-icon">@</div>
        <h3>Start the conversation</h3>
        <p>Send a message to start chatting</p>
      </div>
    `)}var ja,vn,je=w(()=>{"use strict";E();M();y();v();J();B();ja=50,vn=!1});var ce={};S(ce,{appendThreadReply:()=>Qo,closeThread:()=>Qa,deleteThreadReply:()=>to,loadThreadReplies:()=>Sn,openThread:()=>Za,removeThreadReplyFromView:()=>tr,sendThreadReply:()=>eo,updateThreadBadge:()=>nr,updateThreadReply:()=>Ko,updateThreadReplyInView:()=>er});async function Za(e){r.currentThreadId=e,r.threadPanelOpen=!0,Jo().classList.add("active");let n=r.messageCache.get(e);Xo(n),await Sn(e)}function Qa(){r.currentThreadId=null,r.threadPanelOpen=!1;let e=document.getElementById("thread-panel");e&&e.classList.remove("active")}async function Sn(e,t){let n=document.getElementById("thread-messages");if(n)try{let a=`/messages/${e}/thread?limit=${Xa}`;t&&(a+=`&before=${t}`);let s=(await m(a)).replies||[];if(!t)r.threadMessageCache.set(e,s),Zo(s);else{let i=r.threadMessageCache.get(e)||[];r.threadMessageCache.set(e,[...s,...i]),Vo(s)}s.length>=Xa?Yo(e,s[0].id):bn()}catch(a){console.error("Failed to load thread replies:",a),t||(n.innerHTML='<div class="empty-state"><h3>Failed to load replies</h3></div>')}}function Vo(e){let t=document.getElementById("thread-messages");if(!t||e.length===0)return;bn();let n="";for(let a of e)n+=At(a);t.insertAdjacentHTML("afterbegin",n)}function Yo(e,t){bn();let n=document.getElementById("thread-messages");if(!n)return;let a=document.createElement("button");a.className="load-more-btn",a.id="load-more-thread-replies",a.textContent="Load older replies",a.addEventListener("click",async()=>{Mn||(Mn=!0,a.textContent="Loading...",await Sn(e,t),Mn=!1)}),n.insertBefore(a,n.firstChild)}function bn(){let e=document.getElementById("load-more-thread-replies");e&&e.remove()}async function eo(e){if(!(!r.currentThreadId||!e.trim()))try{await m(`/messages/${r.currentThreadId}/thread`,"POST",{content:e});let t=document.getElementById("thread-message-input");t&&(t.value="")}catch(t){console.error("Failed to send thread reply:",t),d(t.message||"Failed to send reply","error")}}async function to(e){if(r.currentThreadId&&confirm("Are you sure you want to delete this reply?"))try{await m(`/messages/${r.currentThreadId}/thread/${e}`,"DELETE"),d("Reply deleted","success")}catch(t){console.error("Failed to delete thread reply:",t),d(t.message||"Failed to delete reply","error")}}async function Ko(e,t){if(r.currentThreadId)try{await m(`/messages/${r.currentThreadId}/thread/${e}`,"PUT",{content:t}),d("Reply updated","success")}catch(n){console.error("Failed to update thread reply:",n),d(n.message||"Failed to update reply","error")}}function Jo(){let e=document.getElementById("thread-panel");if(e?.dataset.initialized)return e;if(!e){e=document.createElement("div"),e.id="thread-panel",e.className="thread-panel";let t=document.getElementById("app-container");t&&t.appendChild(e)}return e.innerHTML=`
    <div class="thread-header" id="thread-header">
      <div class="thread-title">Thread</div>
      <button class="close-thread" id="close-thread-btn">&times;</button>
    </div>
    <div class="thread-parent" id="thread-parent"></div>
    <div class="thread-divider">Replies</div>
    <div class="thread-messages" id="thread-messages"></div>
    <div class="thread-input-area">
      <textarea class="message-input" id="thread-message-input" placeholder="Reply in thread..."></textarea>
      <button class="send-button" id="thread-send-button">&rarr;</button>
    </div>
  `,e.dataset.initialized="true",document.getElementById("close-thread-btn").addEventListener("click",Qa),document.getElementById("thread-send-button").addEventListener("click",()=>{let t=document.getElementById("thread-message-input");t.value.trim()&&eo(t.value)}),document.getElementById("thread-message-input").addEventListener("keydown",t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),document.getElementById("thread-send-button").click())}),document.getElementById("thread-messages").addEventListener("click",async t=>{let n=t.target.closest(".thread-reply-delete");if(n){let o=n.dataset.replyId;await to(o);return}let a=t.target.closest(".thread-reply-edit");if(a){let o=a.dataset.replyId,i=t.target.closest(".thread-reply")?.querySelector(".message-text")?.textContent||"";le({id:o,content:i}),r.currentMessageForEdit=o,r.currentMessageForEditIsThread=!0;return}}),e}function Xo(e){let t=document.getElementById("thread-parent");if(!t||!e)return;let n=k(e.author?.userName||"Unknown"),a=Ge(e.timestamp||e.createdAt),o=We(e.content);t.innerHTML=`
    <div class="message thread-parent-message">
      <div class="message-avatar">${n}</div>
      <div class="message-content">
        <div class="message-header">
          <span class="message-author">${e.author?.userName||"Unknown"}</span>
          <span class="message-time">${a}</span>
        </div>
        <div class="message-text">${o}</div>
      </div>
    </div>
  `}function Zo(e){let t=document.getElementById("thread-messages");if(!t)return;if(e.length===0){t.innerHTML=`
      <div class="empty-state">
        <p>No replies yet. Start the conversation!</p>
      </div>
    `;return}let n="";for(let a of e)n+=At(a);t.innerHTML=n}function At(e){let t=e.author.id===r.currentUser?.id,n=k(e.author.userName),a=Ge(e.timestamp||e.createdAt),o=We(e.content),s="";return t&&(s=`
      <div class="message-actions">
        <button class="message-edit thread-reply-edit" data-reply-id="${e.id}">Edit</button>
        <button class="message-delete thread-reply-delete" data-reply-id="${e.id}">Delete</button>
      </div>
    `),`
    <div class="message thread-reply" data-reply-id="${e.id}">
      <div class="message-avatar">${n}</div>
      <div class="message-content">
        <div class="message-header">
          <span class="message-author">${e.author.userName}</span>
          <span class="message-time">${a}</span>
        </div>
        <div class="message-text">${o}</div>
        ${s}
      </div>
    </div>
  `}function Qo(e){if(!r.threadPanelOpen||r.currentThreadId!==e.threadId)return;let t=document.getElementById("thread-messages");if(!t)return;let n=t.querySelector(".empty-state");if(n&&n.remove(),t.querySelector(`[data-reply-id="${e.id}"]`))return;let a=r.threadMessageCache.get(e.threadId)||[];a.push(e),r.threadMessageCache.set(e.threadId,a);let o=At(e);t.insertAdjacentHTML("beforeend",o),t.scrollTop=t.scrollHeight}function er(e){if(!r.threadPanelOpen||r.currentThreadId!==e.threadId)return;let t=document.querySelector(`[data-reply-id="${e.id}"]`);if(!t)return;let n=At(e),a=document.createElement("div");a.innerHTML=n,t.replaceWith(a.firstElementChild)}function tr(e,t){if(!r.threadPanelOpen||r.currentThreadId!==t)return;let n=document.querySelector(`[data-reply-id="${e}"]`);n&&n.remove();let o=(r.threadMessageCache.get(t)||[]).filter(s=>s.id!==e);if(r.threadMessageCache.set(t,o),o.length===0){let s=document.getElementById("thread-messages");s&&(s.innerHTML='<div class="empty-state"><p>No replies yet. Start the conversation!</p></div>')}}function nr(e,t){let n=document.querySelector(`.message[data-id="${e}"]`);if(!n)return;let a=n.querySelector(".thread-badge");if(!t||t.replyCount===0){a&&a.remove();return}if(!a){a=document.createElement("div"),a.className="thread-badge",a.addEventListener("click",()=>Za(e));let i=n.querySelector(".message-reactions");i&&i.parentNode.insertBefore(a,i.nextSibling)}let o=t.replyCount===1?"1 reply":`${t.replyCount} replies`,s=t.lastReplyBy?.userName||"Someone";a.innerHTML=`<span class="thread-badge-count">${o}</span> <span class="thread-badge-last">Last reply by ${s}</span>`}var Xa,Mn,de=w(()=>{"use strict";E();v();y();J();B();Xa=50,Mn=!1});async function oo(e){let t=mn(e);if(!(!t.trim()&&r.pendingUploads.length===0)){if(t.length>1e3){d(`Message too long. Your message is ${t.length} characters long and we support up to ${1e3} characters.`,"error");return}if(r.viewMode==="dm"&&r.currentConversationId){let{sendDMMessage:n,uploadDMImage:a}=await Promise.resolve().then(()=>(je(),Ja));try{let o=[];if(r.pendingUploads.length>0)for(let s of r.pendingUploads){let i=await a({name:s.fileName,blob:s.blob,thumbnailBlob:s.thumbnailBlob});i&&o.push(i),URL.revokeObjectURL(s.preview)}await n(t,o)}catch(o){d(o.message||"Failed to send message","error")}return}try{H.value="";let n=`temp-${Date.now()}`,a=p.querySelector(".empty-state");a&&a.remove();let o={content:t};r.pendingUploads.length>0&&(o.images=[]);let s=await m(`/channels/${r.currentChannelId}/messages`,"POST",o);if(!s.message?.id)throw new Error("Failed to create message");let i=s.message.id;r.tempIdMap.set(n,i),r.messageCache.delete(n),r.messageCache.set(i,{...s.message,content:s.message.content}),so(n,i),r.pendingUploads.length>0&&(await ar(i),await Bn(i,r.pendingUploads))}catch(n){d(n.message||"Failed to send message","error")}}}async function ar(e){try{C();let t=await b(),n={"Content-Type":"application/json"};t&&(n.Authorization=`Bearer ${t}`);let a=[],o=new Set;for(let s of r.pendingUploads){if(o.has(s.fileHash)){console.log(`Skipping duplicate image with hash: ${s.fileHash}`),URL.revokeObjectURL(s.preview);continue}o.add(s.fileHash);let i=await Ct(s.blob),c=s.thumbnailBlob?await Ct(s.thumbnailBlob):void 0,u={filename:s.fileName,image:i};c&&(u.thumbnail=c);let l=await m(`/channels/${r.currentChannelId}/messages/image`,"POST",u),{filename:g}=l;a.push(g),URL.revokeObjectURL(s.preview)}if(a.length>0&&(await m(`/messages/${e}`,"PUT",{images:a}),r.messageCache.has(e))){let s=r.messageCache.get(e);s.images=a,r.messageCache.set(e,s)}r.pendingUploads=[],Me(),f(),a.length>0&&d("Images uploaded successfully")}catch(t){f(),d(t.message||"Failed to upload images","error")}}async function $t(e){if(document.querySelector(`.message[data-id="${e.id}"]`))return;if(!e.id.startsWith("temp-")){let a=document.querySelectorAll(".message");for(let o of a){let s=o.dataset.authorId===e.author.id,i=o.querySelector(".message-text")?.textContent===e.content,c=o.dataset.id.startsWith("temp-");if(s&&i&&c){console.log(`Found matching temp message, updating ID from ${o.dataset.id} to ${e.id}`),so(o.dataset.id,e.id),r.messageCache.delete(o.dataset.id),r.messageCache.set(e.id,e),r.tempIdMap.set(o.dataset.id,e.id);return}}}r.messageCache.set(e.id,e);let t=ht(new Date(e.timestamp||e.createdAt));sr(t);let n=document.createElement("div");n.className="message",n.dataset.id=e.id,n.dataset.authorId=e.author.id,n.dataset.date=t,n.innerHTML=or(e),ir(e,n),p.prepend(n),await rr(e),e.images&&e.images.length>0&&await Bn(e.id,e.images)}async function Bn(e,t){let n=document.querySelector(`.message[data-id="${e}"]`);if(n){let a=n.querySelector(".message-images-container");if(!a){let o=n.querySelector(".message-content");a=document.createElement("div"),a.className="message-images-container";let s=n.querySelector(".message-reactions");o.insertBefore(a,s)}for(let o of t){let s=`${z}/channels/${r.currentChannelId}/messages/image/${o}`,i=`img-container-${e}-${o}`,c=document.createElement("div");c.id=i,c.className="message-image-container",a.appendChild(c),await Pn(s,i,e,o)}}}function or(e){let t="Unknown User";e.author?.userName?t=e.author.userName:e.author.id===r.currentUser.id&&(t=r.currentUser.userName);let n=k(t),a=e.timestamp||e.createdAt,o=Ce(new Date(a)),s="";if(e.content){let c=Oe(e.content);c=Dn(c),c=Rn(c),s=`<div class="message-text">${c}</div>`}let i=e.threadMeta?`<div class="thread-badge" data-thread-id="${e.id}">
        <span class="thread-badge-count">${e.threadMeta.replyCount} ${e.threadMeta.replyCount===1?"reply":"replies"}</span>
        <span class="thread-badge-last">Last reply by ${e.threadMeta.lastReplyBy?.userName||"Someone"}</span>
      </div>`:"";return`
  <div class="message-avatar">${n}</div>
  <div class="message-content">
    <div class="message-header">
      <span class="message-author">${t}</span>
      ${e.author?.isBot?'<span class="bot-badge">BOT</span>':""}
      <span class="message-time">${o}</span>
    </div>
    ${s}
    <div class="message-images-container"></div>
    <div class="message-reactions"></div>
    ${i}
    <div class="message-actions">
      ${e.author.id===r.currentUser?.id?`
        <button class="message-edit" data-id="${e.id}">Edit</button>
        <button class="message-delete" data-id="${e.id}">Delete</button>
      `:e.author?.isBot&&r.currentUser?.isAdmin?`<button class="message-delete" data-id="${e.id}">Delete</button>`:""}
      <div class="add-reaction" data-id="${e.id}">+ Add Reaction</div>
      <div class="start-thread" data-id="${e.id}">Reply</div>
    </div>
  </div>
`}async function rr(e){if(e.reactions&&Object.keys(e.reactions).length>0){let t=yn(e.reactions);for(let[n,a]of Object.entries(t)){let o=a.includes(r.currentUser.id);await be(e.id,n,a.length,o)}}}function sr(e){let t=!1,n=document.querySelectorAll(".message-date-divider");for(let a of n)if(a.textContent===e){t=!0;break}if(!t){let a=document.createElement("div");a.className="message-date-divider",a.textContent=e,p.prepend(a)}}function ir(e,t){let n=t.querySelector(".message-edit");n&&n.addEventListener("click",()=>le(e));let a=t.querySelector(".message-delete");a&&a.addEventListener("click",()=>dr(e.id));let o=t.querySelector(".add-reaction");o&&o.addEventListener("click",()=>Ve(e.id));let s=t.querySelector(".start-thread");s&&s.addEventListener("click",async()=>{let{openThread:c}=await Promise.resolve().then(()=>(de(),ce));c(e.id)});let i=t.querySelector(".thread-badge");i&&i.addEventListener("click",async()=>{let{openThread:c}=await Promise.resolve().then(()=>(de(),ce));c(e.id)})}async function Un(e,t){try{t||(r.messageCache.clear(),p.innerHTML="");let n=`/channels/${e}/messages?limit=${ao}`;t&&(n+=`&before=${t}`);let{messages:a}=await m(n);if(!a||a.length===0){t||ro(),Tn();return}let o={};for(let c of a){let u=ht(new Date(c.createdAt));r.messageCache.set(c.id,c),o[u]||(o[u]=[]),o[u].push(c)}let s=Object.keys(o).sort((c,u)=>new Date(u)-new Date(c)),i=document.querySelectorAll(".message-date-divider");for(let c of s){if(!Array.from(i).some(l=>l.textContent===c)){let l=document.createElement("div");l.className="message-date-divider",l.textContent=c,p.appendChild(l)}for(let l of o[c])await $t(l)}a.length>=ao?cr(e,a[0].id):Tn()}catch(n){console.error("Error loading messages:",n),d("Failed to load messages","error")}}function cr(e,t){Tn();let n=document.createElement("button");n.className="load-more-btn",n.id="load-more-messages",n.textContent="Load older messages",n.addEventListener("click",async()=>{Ln||(Ln=!0,n.textContent="Loading...",await Un(e,t),Ln=!1)}),p.appendChild(n)}function Tn(){let e=document.getElementById("load-more-messages");e&&e.remove()}function ro(){let e=p.querySelectorAll(".empty-state");for(let n of e)n.remove();let t=document.createElement("div");t.className="empty-state",t.innerHTML=`
    <div class="empty-state-icon">\u{1F4AC}</div>
    <h3>No messages yet</h3>
    <p>Start the conversation!</p>
  `,p.appendChild(t)}function so(e,t){let n=document.querySelector(`.message[data-id="${e}"]`);if(n){n.dataset.id=t;let a=n.querySelectorAll(`[data-id="${e}"]`);for(let s of a)s.dataset.id=t;let o=n.querySelectorAll(`[data-message-id="${e}"]`);for(let s of o)s.dataset.messageId=t}}async function io(e,t){let n=Le(e);if(!n){d("Invalid message ID","error");return}try{if(await m(`/messages/${n}`,"PUT",{content:t}),r.messageCache.has(e)){let a=r.messageCache.get(e);r.messageCache.set(e,{...a,content:t})}await An({id:e,content:t}),d("Message updated successfully")}catch(a){d(a.message||"Failed to update message","error")}}async function dr(e){let t=Le(e);if(!t){d("Invalid message ID","error");return}if(confirm("Are you sure you want to delete this message?"))try{await m(`/messages/${t}`,"DELETE"),$n(e),d("Message deleted successfully")}catch(n){d(n.message||"Failed to delete message","error")}}async function An(e){let t=document.querySelector(`.message[data-id="${e.id}"]`);if(t){let n=t.querySelector(".message-text");if(n){let a=Oe(e.content);a=Dn(a),a=Rn(a),n.innerHTML=a}e.images&&e.images.length>0&&await Bn(e.id,e.images)}}function $n(e){let t=document.querySelector(`.message[data-id="${e}"]`);if(t){t.remove();let n=document.querySelectorAll(".message-date-divider");for(let a of n){let o=a.nextElementSibling;(!o||o.classList.contains("message-date-divider"))&&a.remove()}document.querySelector(".message")||ro()}}function Dn(e){let t=/https?:\/\/[^\s]+/g;return e.replace(t,n=>`<a href="${n}" target="_blank" class="message-link">${n}</a>`)}function We(e){if(!e)return"";let t=Oe(e);return t=Dn(t),t=Rn(t),t}function Ge(e){return Ce(new Date(e))}function Rn(e){let t=/#([a-zA-Z0-9_-]+)/g;return e.replace(t,(n,a)=>{let s=Array.from(te.querySelectorAll(".channel-item")).find(i=>i.querySelector(".channel-name").textContent.toLowerCase()===a.toLowerCase())?.dataset.id||"";return s?`<a href="#" class="channel-link" data-channel-id="${s}" data-channel-name="${a}">${n}</a>`:n})}function Le(e){if(e?.startsWith("temp-")){let t=r.tempIdMap.get(e);if(t)return t}return e}async function co(e,t){let n=`temp-${Date.now()}`,a={id:n,content:t.content||"",author:r.currentUser,createdAt:new Date().toISOString(),reactions:{},images:[],isOffline:!0};return r.messageCache.set(n,a),await $t(a),d("Message saved locally. Will sync when online.","info"),{message:a}}async function lo(e,t){try{let n=Le(e);if(!n){d("Invalid message ID","error");return}let a=r.messageCache.get(e);if(!a||!a.images){d("Message data not found","error");return}if(!a.author||a.author.id!==r.currentUser.id){d("You don't have permission to remove this image","error");return}let o=a.images.filter(i=>i!==t);await m(`/messages/${n}`,"PUT",{images:o}),a.images=o,r.messageCache.set(e,a);let s=document.getElementById(`img-container-${e}-${t}`);s&&s.remove(),d("Image removed successfully")}catch(n){d(n.message||"Failed to remove image","error")}}var ao,Ln,J=w(()=>{"use strict";E();M();T();v();y();N();B();kt();ze();ao=50,Ln=!1});var _n={};S(_n,{createChannel:()=>Nn,deleteChannel:()=>Fn,loadChannels:()=>X,restoreLastChannel:()=>lr,selectChannel:()=>Te,updateChannelName:()=>On});async function X(){try{let{channels:e}=await m("/channels");te.innerHTML="";for(let t of e)await Be(t);if(e.length>0&&!r.currentChannelId){let t=null;try{t=await r.storage.getItem("currentChannelId")}catch{}t||(t=localStorage.getItem("lastChannelId"));let n=e.find(a=>a.id===t)||e[0];await Te(n.id,n.name)}return e}catch{d("Failed to load channels","error")}}async function Te(e,t){if(e===r.currentChannelId&&r.viewMode==="channel")return;r.currentConversationId=null,r.viewMode="channel",document.querySelectorAll(".dm-item").forEach(a=>{a.classList.remove("active")}),G.style.removeProperty("--channel-prefix"),r.currentChannelId=e,G.textContent=t,await r.storage.setItem("currentChannelId",e),localStorage.setItem("lastChannelId",e),r.unreadCounts.set(e,0),Z();let n=te.querySelectorAll(".channel-item");for(let a of n)if(a.dataset.id===e){a.classList.add("active");let o={id:e,name:t};a.querySelector(".channel-settings")&&(o.createdBy=r.currentUser.id),await Be(o)}else a.classList.remove("active");await Un(e),await ue(e)}async function Nn(e){try{let{channel:t}=await m("/channels","POST",{name:e});d(`Channel #${e} created successfully!`),await X(),await Te(t.id,t.name)}catch(t){throw d(t.message||"Failed to create channel","error"),t}}async function Fn(e){try{await m(`/channels/${e}`,"DELETE"),d("Channel deleted successfully");let t=await X();await Te(t[0].id,t[0].name)}catch(t){throw d(t.message||"Failed to delete channel","error"),t}}async function On(e,t){try{let{channel:n}=await m(`/channels/${e}`,"PUT",{name:t});return d(`Channel renamed to #${t} successfully`),r.currentChannelId===e&&(G.textContent=t),await X(),n}catch(n){throw d(n.message||"Failed to update channel name","error"),n}}async function lr(){let e=null;try{e=await r.storage.getItem("currentChannelId")}catch{}if(e||(e=localStorage.getItem("lastChannelId")),!e)return;let t=document.querySelector(`.channel-item[data-id="${e}"]`);t&&t.click()}var Ye=w(()=>{"use strict";E();M();v();y();J();Ke()});var po={};S(po,{closeStartDmModalFn:()=>Pt,incrementDmUnread:()=>Gn,loadConversations:()=>Dt,openStartDmModal:()=>jn,renderConversationItem:()=>uo,renderConversationsList:()=>Rt,selectConversation:()=>zn,startConversation:()=>mo,updateConversationInCache:()=>Wn});async function Dt(){try{let t=(await m("/conversations")).conversations||[];r.conversationCache.clear();for(let n of t)r.conversationCache.set(n.id,n);Rt(t)}catch(e){console.error("Failed to load conversations:",e)}}function Rt(e){if(Pe){if(Pe.innerHTML="",e.length===0){Pe.innerHTML='<div class="empty-list">No conversations yet</div>';return}for(let t of e){let n=uo(t);Pe.appendChild(n)}}}function uo(e){let t=document.createElement("div");t.className="dm-item",t.dataset.conversationId=e.id,r.currentConversationId===e.id&&t.classList.add("active");let a=e.otherUser?.userName||"Unknown User",o=a.charAt(0).toUpperCase();return t.innerHTML=`
    <div class="dm-avatar">${o}</div>
    <span class="dm-name">${a}</span>
    ${ur(e.id)}
  `,t.addEventListener("click",()=>zn(e.id)),t}function ur(e){let t=r.dmUnreadCounts.get(e)||0;return t>0?`<div class="notification-badge">${t>99?"99+":t}</div>`:""}async function zn(e){r.currentChannelId=null,r.viewMode="dm",document.querySelectorAll(".channel-item").forEach(o=>{o.classList.remove("active")}),document.querySelectorAll(".dm-item").forEach(o=>{o.classList.toggle("active",o.dataset.conversationId===e)}),r.currentConversationId=e,r.dmUnreadCounts.set(e,0),Z();let t=document.querySelector(`.dm-item[data-conversation-id="${e}"]`);if(t){let o=t.querySelector(".notification-badge");o&&o.remove()}let n=r.conversationCache.get(e);if(n&&G){let o=n.otherUser?.userName||"Direct Message";G.textContent=o,G.style.setProperty("--channel-prefix",'"@"')}await Lt(e);let a=document.getElementById("sidebar");a&&a.classList.remove("open")}async function mo(e){try{let t=await m("/conversations","POST",{targetUserId:e}),{conversation:n,isNew:a}=t;r.conversationCache.set(n.id,n),await Dt(),await zn(n.id),Pt(),a&&d("Conversation started","success")}catch(t){console.error("Failed to start conversation:",t),d(t.message||"Failed to start conversation","error")}}async function jn(){if(!Ne||!re)return;Ne.classList.add("active");let e=document.getElementById("dm-user-search");e&&(e.value="",e.focus());try{let a=((await m("/users")).users||[]).filter(o=>o.id!==r.currentUser?.id);if(qn=a,Hn(a),e){let o=e.cloneNode(!0);e.parentNode.replaceChild(o,e),o.focus(),o.addEventListener("input",()=>{let s=o.value.trim().toLowerCase();if(!s){Hn(qn);return}let i=qn.filter(c=>(c.userName||"").toLowerCase().includes(s)||(c.email||"").toLowerCase().includes(s));Hn(i)})}}catch(t){console.error("Failed to load users:",t),re.innerHTML='<div class="empty-list">Failed to load users</div>'}}function Pt(){Ne&&Ne.classList.remove("active")}function Hn(e){if(re){if(re.innerHTML="",e.length===0){re.innerHTML='<div class="empty-list">No other users available</div>';return}for(let t of e){let n=document.createElement("div");n.className="dm-user-item";let a=t.userName?.charAt(0).toUpperCase()||t.email.charAt(0).toUpperCase();n.innerHTML=`
      <div class="user-avatar">${a}</div>
      <div class="user-info">
        <div class="user-name">${t.userName||t.email.split("@")[0]}</div>
        <div class="user-email">${t.email}</div>
      </div>
    `,n.addEventListener("click",()=>mo(t.id)),re.appendChild(n)}}}function Wn(e){r.conversationCache.set(e.id,e);let t=Array.from(r.conversationCache.values());t.sort((n,a)=>(a.lastMessageAt||a.createdAt)-(n.lastMessageAt||n.createdAt)),Rt(t)}function Gn(e){if(r.currentConversationId===e)return;let t=r.dmUnreadCounts.get(e)||0;r.dmUnreadCounts.set(e,t+1);let n=Array.from(r.conversationCache.values());Rt(n)}var qn,Nt=w(()=>{"use strict";E();M();y();je();v();qn=[]});var Ft={};S(Ft,{createWebhook:()=>pr,deleteWebhook:()=>go,loadWebhooks:()=>mr});async function mr(){let e=document.getElementById("webhooks-list"),t=document.getElementById("webhook-channel-select");if(!(!e||!t))try{let n=await m("/webhooks","GET");e.innerHTML="";let a=await m("/channels","GET");t.innerHTML="";for(let o of a.channels||[]){let s=document.createElement("option");s.value=o.id,s.textContent=o.name,t.appendChild(s)}if(n.webhooks&&n.webhooks.length>0)for(let o of n.webhooks){let s=(a.channels||[]).find(h=>h.id===o.channelId),i=s?s.name:"Unknown",c=document.createElement("div");c.className="webhook-item",c.dataset.id=o.id;let u=`${location.origin}/webhooks/${o.id}/messages`;c.innerHTML=`
          <div class="webhook-info">
            <div class="webhook-name">${o.name}</div>
            <div class="webhook-channel">ID: ${o.id}</div>
            <div class="webhook-channel">Channel: #${i}</div>
            <div class="webhook-url-row">
              <code class="webhook-url">${u}</code>
              <button class="btn webhook-copy-url" title="Copy URL">Copy URL</button>
            </div>
          </div>
          <div class="webhook-actions">
            <button class="remove-webhook" title="Delete Webhook">&#10005;</button>
          </div>
        `;let l=c.querySelector(".webhook-copy-url");l&&l.addEventListener("click",()=>{navigator.clipboard.writeText(u),d("URL copied to clipboard")});let g=c.querySelector(".remove-webhook");g&&g.addEventListener("click",()=>go(o.id,o.name)),e.appendChild(c)}else e.innerHTML='<div class="empty-list">No webhooks created yet</div>'}catch{}}async function pr(e,t){let n=document.getElementById("webhooks-list"),a=document.getElementById("webhook-name-input");try{C();let o=await m("/webhooks","POST",{name:e,channelId:t});if(f(),o.webhook){d("Webhook created successfully!");let s=document.querySelector(".webhook-token-display");s&&s.remove();let i=`${location.origin}/webhooks/${o.webhook.id}/messages`,c=document.createElement("div");c.className="webhook-token-display",c.innerHTML=`
        <div class="webhook-token-label">URL:</div>
        <code class="webhook-token-value">${i}</code>
        <button class="btn webhook-token-copy-url">Copy URL</button>
        <div class="webhook-token-label">Token (copy now, shown only once):</div>
        <code class="webhook-token-value">${o.webhook.token}</code>
        <button class="btn webhook-token-copy">Copy Token</button>
      `,n&&n.before(c);let u=c.querySelector(".webhook-token-copy-url");u&&u.addEventListener("click",()=>{navigator.clipboard.writeText(i),d("URL copied to clipboard")});let l=c.querySelector(".webhook-token-copy");l&&l.addEventListener("click",()=>{navigator.clipboard.writeText(o.webhook.token),d("Token copied to clipboard")}),a&&(a.value="")}}catch(o){f(),d(o.message||"Failed to create webhook","error")}}async function go(e,t){if(confirm(`Are you sure you want to delete webhook "${t}"?`))try{C(),await m(`/webhooks/${e}`,"DELETE"),f(),d(`Webhook "${t}" has been deleted`)}catch(n){f(),d(n.message||"Failed to delete webhook","error")}}var Ot=w(()=>{"use strict";v();y()});async function ue(e){r.messageEventSource&&(r.messageEventSource.close(),r.messageEventSource=null),Je&&(clearTimeout(Je),Je=null);let t=await b();if(t)try{r.messageEventSource=new EventSource(`${z}/events?token=${t}`),r.messageEventSource.onopen=function(){Ue=0,Vn=0},r.messageEventSource.onmessage=async function(n){try{let a=JSON.parse(n.data);switch(!1,a.type){case"CONNECTED":break;case"NEW_MESSAGE":if(a.payload.channelId===r.currentChannelId)await $t(a.payload);else{let o=r.unreadCounts.get(a.payload.channelId)||0;r.unreadCounts.set(a.payload.channelId,o+1);let s=document.querySelector(`.channel-item[data-id="${a.payload.channelId}"]`);if(s){let u=s.querySelector(".channel-name").textContent;await Be({id:a.payload.channelId,name:u})}let i=a.payload.author?.userName||"Someone",c=s?s.querySelector(".channel-name").textContent:"another channel";d(`${i} posted in #${c}`,"info"),Z(),Xe(`#${c}`,`${i}: ${a.payload.content}`)}break;case"UPDATE_MESSAGE":a.payload.channelId===r.currentChannelId&&(r.messageCache.has(a.payload.id)&&r.messageCache.set(a.payload.id,{...r.messageCache.get(a.payload.id),content:a.payload.content,images:a.payload.images,updatedAt:a.payload.updatedAt}),await An(a.payload));break;case"DELETE_MESSAGE":a.payload.channelId===r.currentChannelId&&(r.messageCache.delete(a.payload.id),$n(a.payload.id));break;case"NEW_CHANNEL":X();break;case"UPDATE_CHANNEL":if(X(),a.payload.id===r.currentChannelId){let o=document.getElementById("current-channel-name");o&&(o.textContent=a.payload.name)}break;case"DELETE_CHANNEL":X();break;case"NEW_REACTION":if(a.payload.messageId){let o=a.payload.messageId,s=a.payload.userId,i=a.payload.reaction;s!==r.currentUser.id&&await K(o,i,!0,!0)}break;case"DELETE_REACTION":if(a.payload.messageId){let o=a.payload.messageId,s=a.payload.userId,i=a.payload.reaction;if(r.messageCache.has(o)){let c=r.messageCache.get(o);c.reactions?.[i]&&(c.reactions[i]=c.reactions[i].filter(u=>u!==s),c.reactions[i].length===0&&delete c.reactions[i],r.messageCache.set(o,c))}s!==r.currentUser.id&&await K(o,i,!1,!0)}break;case"REMOVE_USER":a.payload.id===r.currentUser.id&&await Ze();break;case"UPDATE_USER":if(a.payload.id===r.currentUser.id){r.currentUser.userName=a.payload.userName;let{getInitials:o}=await Promise.resolve().then(()=>(B(),Da));document.getElementById("user-avatar").textContent=o(a.payload.userName),document.getElementById("user-name").textContent=a.payload.userName}break;case"NEW_CONVERSATION":await Dt();break;case"NEW_DM_MESSAGE":if(a.payload.channelId.startsWith("dm:")){if(r.viewMode==="dm"&&a.payload.channelId===r.currentConversationId)xn(a.payload);else{Gn(a.payload.channelId);let s=a.payload.author?.userName||"Someone";d(`${s} sent you a direct message`,"info"),Z(),Xe("Direct Message",`${s}: ${a.payload.content}`)}let o=r.conversationCache.get(a.payload.channelId);o&&(o.lastMessageAt=a.payload.createdAt,Wn(o))}break;case"UPDATE_DM_MESSAGE":a.payload.channelId.startsWith("dm:")&&Cn(a.payload);break;case"DELETE_DM_MESSAGE":a.payload.conversationId&&kn(a.payload.id,a.payload.conversationId);break;case"NEW_THREAD_REPLY":{let{appendThreadReply:o,updateThreadBadge:s}=await Promise.resolve().then(()=>(de(),ce));if(a.payload.channelId===r.currentChannelId&&s(a.payload.parentMessageId,a.payload.threadMeta),o(a.payload.reply),a.payload.reply.author.id!==r.currentUser.id){let i=a.payload.reply.author?.userName||"Someone";d(`${i} replied in a thread`,"info"),Xe("Thread Reply",`${i}: ${a.payload.reply.content}`)}break}case"UPDATE_THREAD_REPLY":{let{updateThreadReplyInView:o}=await Promise.resolve().then(()=>(de(),ce));o(a.payload);break}case"DELETE_THREAD_REPLY":{let{removeThreadReplyFromView:o,updateThreadBadge:s}=await Promise.resolve().then(()=>(de(),ce));a.payload.channelId===r.currentChannelId&&s(a.payload.threadId,a.payload.threadMeta),o(a.payload.id,a.payload.threadId);break}case"UPDATE_SERVER_SETTINGS":if(a.payload.name){let o=document.querySelector(".server-name-text");o&&(o.textContent=a.payload.name)}break;case"NEW_WEBHOOK":case"DELETE_WEBHOOK":{if(document.getElementById("server-settings-modal")?.classList.contains("active")){let{loadWebhooks:o}=await Promise.resolve().then(()=>(Ot(),Ft));o()}break}}}catch(a){console.error("Error processing SSE event",a)}},r.messageEventSource.onerror=function(n){if(Vn<fr&&Vn++,r.messageEventSource&&r.messageEventSource.readyState===EventSource.CLOSED){r.messageEventSource.close(),r.messageEventSource=null,Ue++;let a=Math.min(1e3*2**Ue,30*1e3);Ue<=gr?(console.log(`SSE reconnect attempt ${Ue} in ${a}ms`),Je=setTimeout(async()=>{await ue(e)},a)):(console.log("Maximum SSE reconnect attempts reached, trying again in 60s"),Ue=0,Je=setTimeout(async()=>{await ue(e)},60*1e3))}}}catch(n){console.error("Error setting up SSE connection",n)}}function _t(){let e=document.getElementById("offline-bar"),t=document.getElementById("message-input"),n=document.getElementById("send-button");function a(){r.isOffline=!0,e&&e.classList.add("visible"),t&&(t.disabled=!0),n&&(n.disabled=!0),d("You are offline","error")}function o(){r.isOffline=!1,e&&e.classList.remove("visible"),t&&(t.disabled=!1),n&&(n.disabled=!1),d("You are back online","success")}window.addEventListener("offline",a),window.addEventListener("online",o),navigator.onLine||a()}var gr,fr,Ue,Je,Vn,Ke=w(()=>{"use strict";E();T();N();y();J();ze();Ye();Nt();je();gr=5,fr=3,Ue=0,Je=null,Vn=0});var fo={};S(fo,{fetchOAuthProviders:()=>wr,getProviderIcon:()=>yr,handleOAuthCallback:()=>Kn,initiateOAuth:()=>vr,isOAuthCallback:()=>Yn});function yr(e){return hr[e]||""}async function wr(){try{let e=await fetch(`${z}/auth/oauth/providers`);return e.ok?(await e.json()).providers||[]:[]}catch{return[]}}function vr(e){window.location.href=`${z}/auth/oauth/${e}`}function Yn(){let e=new URLSearchParams(window.location.search);return e.has("access_token")||e.has("oauth_error")}async function Kn(){let e=new URLSearchParams(window.location.search),t=e.get("oauth_error");if(t)throw window.history.replaceState({},document.title,window.location.pathname),new Error(t);let n=e.get("access_token"),a=e.get("refresh_token"),o=e.get("expires_in");if(!n)throw new Error("No access token received");await ie(),await me({accessToken:n,refreshToken:a,exp:parseInt(o,10)||900}),_t(),window.history.replaceState({},document.title,window.location.pathname)}var hr,Jn=w(()=>{"use strict";T();N();He();Ke();hr={google:`<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/>
    <path d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z" fill="#34A853"/>
    <path d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707s.102-1.167.282-1.707V4.961H.957C.347 6.175 0 7.55 0 9s.348 2.825.957 4.039l3.007-2.332z" fill="#FBBC05"/>
    <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.961L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z" fill="#EA4335"/>
  </svg>`,github:`<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
  </svg>`,microsoft:`<svg width="18" height="18" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h11v11H0z" fill="#F25022"/>
    <path d="M12 0h11v11H12z" fill="#7FBA00"/>
    <path d="M0 12h11v11H0z" fill="#00A4EF"/>
    <path d="M12 12h11v11H12z" fill="#FFB900"/>
  </svg>`,gitlab:`<svg width="18" height="18" viewBox="0 0 24 24" fill="#FC6D26" xmlns="http://www.w3.org/2000/svg">
    <path d="M23.546 10.93L13.067.452c-.604-.603-1.582-.603-2.188 0L.452 10.93c-.6.605-.6 1.584 0 2.188l10.427 10.426c.603.602 1.582.602 2.188 0l10.48-10.478c.6-.603.6-1.582 0-2.187zm-11.544 11.07L2.468 12.467l9.534-9.533 9.534 9.533-9.534 9.534z"/>
  </svg>`}});async function qt(){try{ho&&Vt&&(Vt.style.display="block");let e=await m("/users","GET");if(ut.innerHTML="",e.users&&e.users.length>0){let t=[...e.users].sort((n,a)=>n.id===r.currentUser.id?-1:a.id===r.currentUser.id?1:0);for(let n of t){let a=document.createElement("div");a.className="user-item",a.dataset.id=n.id;let o=n.id!==r.currentUser.id;a.innerHTML=`
          <div class="user-avatar">${k(n.userName||n.email.split("@")[0])}</div>
          <div class="user-info">
            <div class="user-email">${n.email}</div>
            <div class="user-role ${n.isAdmin?"admin-role":"user-role"}">${n.isAdmin?"Admin":"User"}</div>
            <div class="user-created">Added ${Ce(new Date(n.createdAt))}</div>
          </div>
          ${o?`
            <div class="user-actions">
              ${ho?'<button class="reset-password-user" title="Reset Password">\u21BB</button>':""}
              <button class="remove-user" title="Remove User">\u2715</button>
            </div>
          `:""}
        `;let s=a.querySelector(".remove-user");s&&s.addEventListener("click",()=>Ir(n.id,n.email));let i=a.querySelector(".reset-password-user");i&&i.addEventListener("click",()=>Er(n.id,n.email)),ut.appendChild(a)}}else ut.innerHTML='<div class="empty-list">No users added yet</div>'}catch(e){console.error("Error loading users:",e),d("Failed to load users","error")}}async function yo(e,t,n){try{C();let a={email:e,role:t};n&&(a.password=n);let o=await m("/users/add","POST",a);f(),o.success&&(d(`User ${e} added successfully!`),qt())}catch(a){f(),d(a.message||"Failed to add user","error")}}async function Er(e,t){let n=prompt(`Enter new password for ${t} (min 8 characters):`);if(n){if(n.length<8){d("Password must be at least 8 characters","error");return}try{C(),await m(`/users/${e}/reset-password`,"POST",{password:n}),f(),d(`Password reset for ${t}`)}catch(a){f(),d(a.message||"Failed to reset password","error")}}}async function Ir(e,t){if(confirm(`Are you sure you want to remove user ${t}?`))try{C(),await m(`/users/${e}`,"DELETE"),f(),d(`User ${t} has been removed`),qt()}catch(n){f(),d(n.message||"Failed to remove user","error")}}var ho,Zn=w(()=>{"use strict";E();M();v();y();B();T();ho=x==="password"&&!!1});var wo={};S(wo,{closeUserSettingsModal:()=>zt,hideServerSettingsModal:()=>Ht,loadServerName:()=>xr,openServerSettingsModal:()=>Qn,openUserSettingsModal:()=>ta,updateServerName:()=>ea,updateUserName:()=>na});function Qn(){let e=st.textContent.trim().replace(/\s+/g," ");ye.value=e,on.classList.add("active"),ye.focus(),qt();let t=document.getElementById("webhooks-section");r.currentUser?.isAdmin?(t&&(t.style.display="block"),Promise.resolve().then(()=>(Ot(),Ft)).then(({loadWebhooks:n})=>n())):t&&(t.style.display="none")}function Ht(){on.classList.remove("active");let e=document.querySelector(".webhook-token-display");e&&e.remove()}async function ea(e){try{C();let t=await m("/server/settings","PUT",{name:e});return it.textContent=e,await r.storage.setItem("serverName",e),Ht(),d("Server name updated successfully"),f(),t}catch(t){throw f(),d(t.message||"Failed to update server name","error"),t}}async function xr(){try{let t=await m("/server/settings","GET");if(t?.name){it.textContent=t.name,await r.storage.setItem("serverName",t.name);return}}catch(t){console.error("Error loading server name from API:",t)}let e=await r.storage.getItem("serverName");e&&(it.textContent=e)}function ta(){we.value=r.currentUser?.userName||"",dn.classList.add("active"),we.focus()}function zt(){dn.classList.remove("active")}async function na(e){let t=e?.trim();if(!t)return d("Name cannot be empty","error");try{C(),await m("/users/me","PUT",{userName:t}),r.currentUser.userName=t,lt.textContent=k(t),mt.textContent=t,zt(),d("Display name updated"),f()}catch(n){f(),d(n.message||"Failed to update display name","error")}}var aa=w(()=>{"use strict";E();M();v();y();Zn();B()});var F={};S(F,{closeAllModals:()=>Gt,closeCreateChannelModal:()=>jt,closeEditChannelModal:()=>et,closeEditModal:()=>Wt,closeReactionPicker:()=>ia,getReactionCount:()=>Mt,hideLoading:()=>f,isReacted:()=>Mo,openCreateChannelModal:()=>sa,openEditChannelModal:()=>So,openEditModal:()=>le,openReactionPicker:()=>Ve,reacted:()=>St,renderChannelItem:()=>Be,renderDevModeEncryptionSignInView:()=>oa,renderDevModePlainSignInView:()=>Eo,renderForgotPasswordView:()=>Sr,renderMagicLinkEncryptionSignInView:()=>ra,renderMagicLinkUnauthenticatedView:()=>Io,renderNewMagicLink:()=>Lr,renderPasswordRegisterView:()=>Mr,renderPasswordResetSent:()=>br,renderPasswordResetView:()=>ko,renderPasswordSetupView:()=>Co,renderPasswordSignInView:()=>xo,renderReaction:()=>be,scrollToBottom:()=>Ut,showAppScreen:()=>Qe,showAuthScreen:()=>W,showDesktopNotification:()=>Xe,showLoading:()=>C,showToast:()=>d,signInWithMagicLink:()=>vo,updateDocumentTitle:()=>Z,updatePendingUploadsUI:()=>Me,updateReactionCount:()=>Se});async function W(){Gt(),Jt.style.display="block",Kt.style.display="none",kr();let e=tt();if(x==="dev")return Q()||e?oa():Eo();if(x==="magic-link"){if(Y())return Q()?ra():vo();if(e){if(Q())return ra();await ke(V)}return Io()}if(x==="password"){let{emailParam:t,tokenParam:n,resetParam:a}=j();return t&&n&&a?ko(t):t&&n?Co(t):e?(await ke(V),await Qe()):xo()}}async function kr(){if(!!1){se.style.display="none",Fe.style.display="none";return}try{let{fetchOAuthProviders:e,getProviderIcon:t,initiateOAuth:n}=await Promise.resolve().then(()=>(Jn(),fo)),a=await e();if(a.length===0){se.style.display="none",Fe.style.display="none";return}se.innerHTML=a.map(o=>{let s=t(o.id);return`<button type="button" class="btn oauth-btn oauth-btn-${o.id}" data-provider="${o.id}">
          ${s?`<span class="oauth-btn-icon">${s}</span>`:""}
          <span>Sign in with ${o.name}</span>
        </button>`}).join(""),se.style.display="block",Fe.style.display="flex",se.querySelectorAll(".oauth-btn").forEach(o=>{o.addEventListener("click",()=>{n(o.dataset.provider)})})}catch(e){console.error("Failed to load OAuth providers:",e),se.style.display="none",Fe.style.display="none"}}function vo(){let{emailParam:e}=j();A.value=e,L.click()}function Eo(){R.textContent="Enter your email to sign in.",$.style.display="none",f()}function oa(){R.textContent="Enter your email and encryption key to sign in.",$.style.display="block",f()}function ra(){if(R.textContent="Enter your encryption key to sign in.",Y()){he.getElementsByTagName("label")[0].style.display="none",A.style.display="none";let{emailParam:t}=j();A.value=t}$.style.display="block",f()}function Io(){R.textContent="Enter your email to get a magic link.",$.style.display="none",f()}function xo(){R.textContent="Enter your email and password to sign in.",$.style.display="none",Ee.style.display="block",ve.style.display="none",Ie.style.display="none",ft.style.display="none",L.textContent="Sign In",f()}function Co(e){R.textContent="Set your password to complete registration.",he.style.display="none",A.value=e,$.style.display="none",Ee.style.display="block",ve.style.display="block",Ie.style.display="none",L.textContent="Set Password",f()}function Mr(){R.textContent="Create your account.",he.style.display="block",$.style.display="none",Ee.style.display="block",ve.style.display="block",Ie.style.display="block",Ma.textContent="Already have an account? Sign In",L.textContent="Create Account",f()}function Sr(){R.textContent="Enter your email to receive a password reset link.",he.style.display="block",A.value="",$.style.display="none",Ee.style.display="none",ve.style.display="none",Ie.style.display="none",ft.style.display="none",L.textContent="Send Reset Link",f()}function ko(e){R.textContent="Reset your password.",he.style.display="none",A.value=e,$.style.display="none",Ee.style.display="block",ve.style.display="block",Ie.style.display="none",ft.style.display="none",L.textContent="Reset Password",f()}function br(e){document.querySelector(".auth-form").style.display="none",Ba.textContent=e||"If a matching account was found, a password reset link has been sent. Please check your inbox.",Ta.style.display="block"}async function Lr(e){let{apiRequest:t}=await Promise.resolve().then(()=>(v(),U)),n=await t("/auth/login","POST",{email:e});document.querySelector(".auth-form").style.display="none";let a=document.getElementById("magic-link-sent-form"),o=document.getElementById("magic-link-sent-message");o.textContent=n.message||`Magic link sent to ${e}. Please check your inbox and click the link to continue.`,a.style.display="block"}async function Qe(){let{loadServerName:e}=await Promise.resolve().then(()=>(aa(),wo)),{loadChannels:t,restoreLastChannel:n}=await Promise.resolve().then(()=>(Ye(),_n)),{loadConversations:a}=await Promise.resolve().then(()=>(Nt(),po));if(r.currentUser=await bo(),!r.currentUser){f();return}window.history.replaceState({},document.title,window.location.pathname),await e(),await t(),await a(),lt.textContent=k(r.currentUser.userName),mt.textContent=r.currentUser.userName,Jt.style.display="none",Kt.style.display="flex",await n();let o=await r.storage.getItem("darkMode")!=="false";await It(o),f()}async function Be(e){let{selectChannel:t}=await Promise.resolve().then(()=>(Ye(),_n)),n=document.querySelector(`.channel-item[data-id="${e.id}"]`);n||(n=document.createElement("div"),n.className="channel-item",n.dataset.id=e.id,n.addEventListener("click",async()=>await t(e.id,e.name)),te.appendChild(n));let a=r.unreadCounts.get(e.id)||0;n.innerHTML="";let o=document.createElement("div");if(o.textContent=e.name,o.className="channel-name",n.appendChild(o),a>0){let s=document.createElement("div");s.className="notification-badge",s.textContent=a>99?"99+":a,n.appendChild(s)}if(e.createdBy===r.currentUser.id){let s=document.createElement("div");s.className="channel-settings",s.innerHTML="\u2699\uFE0F",s.addEventListener("click",i=>{i.stopPropagation(),So(e)}),n.appendChild(s)}e.id===r.currentChannelId?n.classList.add("active"):n.classList.remove("active")}function Me(){let e=document.getElementById("pending-uploads-container"),t=document.getElementById("pending-uploads");if(r.pendingUploads.length===0){e.style.display="none";return}e.style.display="block",t.innerHTML="",r.pendingUploads.forEach((a,o)=>{let s=document.createElement("div");s.className="pending-upload",s.innerHTML=`
      <img src="${a.preview}" alt="Upload preview">
      <div class="remove-upload" data-index="${o}">&times;</div>
    `,t.appendChild(s)}),document.querySelectorAll(".remove-upload").forEach(a=>{a.addEventListener("click",async o=>{let{removePendingUpload:s}=await Promise.resolve().then(()=>(kt(),Ha)),i=Number.parseInt(o.target.dataset.index,10);s(i)})})}async function be(e,t,n,a){let{addReaction:o,removeReaction:s}=await Promise.resolve().then(()=>(ze(),za)),i=yt(e);if(!i)return;let c=document.createElement("div");return c.className=`reaction ${a?"user-reacted":""}`,c.dataset.reaction=t,c.dataset.messageId=e,c.innerHTML=`
        <span class="reaction-reaction">${t}</span>
        <span class="reaction-count">${n}</span>
      `,c.addEventListener("click",async()=>{Mo(c)?await s(e,t):await o(e,t)}),i.appendChild(c),c}function Mt(e){if(!e)return 0;let t=e.querySelector(".reaction-count");if(t)return Number.parseInt(t.textContent,10)||0}function Se(e,t){if(!e)return;let n=e.querySelector(".reaction-count");n&&(n.textContent=t.toString())}function St(e,t){e&&(e.className=`reaction ${t?"user-reacted":""}`)}function Mo(e){if(e)return Array.from(e.classList).includes("user-reacted")}function d(e,t="success"){Re.textContent=e,Re.className=`toast ${t}`,Re.classList.add("show"),setTimeout(()=>{Re.classList.remove("show")},3e3)}function Ut(){let e=document.getElementById("messages-area");e&&(e.scrollTop=0)}function C(){nn.style.display="flex"}function f(){nn.style.display="none"}function sa(){Xt.classList.add("active"),fe.focus()}function jt(){Xt.classList.remove("active"),fe.value=""}function Ve(e){r.currentMessageForReaction=e,Ae.classList.add("active")}function ia(){Ae.classList.remove("active"),r.currentMessageForReaction=null}function le(e){r.currentMessageForEdit=e.id,ae.value=e.content,en.classList.add("active"),ae.focus()}function Wt(){en.classList.remove("active"),ae.value="",r.currentMessageForEdit=null}function So(e){r.currentChannelForEdit=e,ne.value=e.name,Qt.classList.add("active"),ne.focus()}function et(){Qt.classList.remove("active"),ne.value="",r.currentChannelForEdit=null}function Gt(){document.querySelectorAll(".modal-backdrop.active").forEach(n=>{n.classList.remove("active")}),r.currentMessageForReaction=null,r.currentMessageForEdit=null,r.currentChannelForEdit=null;let t=document.querySelector(".webhook-token-display");t&&t.remove()}function Z(){let e=0;for(let t of r.unreadCounts.values())e+=t;for(let t of r.dmUnreadCounts.values())e+=t;document.title=e>0?`(${e}) MikroChat`:"MikroChat"}async function Xe(e,t){if(!("Notification"in window)||document.hasFocus()||(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted"))return;let n=new Notification(e,{body:t,icon:"/icons/icon-192.png"});n.onclick=()=>{window.focus(),n.close()}}var y=w(()=>{"use strict";E();M();T();vt();Et();N();He();B();gn()});var U={};S(U,{apiRequest:()=>m,fetchImageWithAuth:()=>Pn});async function m(e,t="GET",n=null,a=null){if(!navigator.onLine&&t!=="GET"){if(e.includes("/channels/")&&e.includes("/messages")&&t==="POST")return co(e,n);throw d("You're offline. This action will be available when you reconnect.","error"),new Error("Offline - cannot perform this action")}if(x!=="dev"&&e!=="/auth/login")try{if(await Lo()){await To();let c=await b();c&&await r.storage.setItem("accessToken",c)}}catch(c){throw console.error("Token refresh failed:",c),await r.storage.removeItem("accessToken"),r.currentUser=null,await W(),d("Session expired. Please log in again.","error"),new Error("Authentication failed")}let o={"Content-Type":"application/json"},s=a;r.isStorageInitialized&&(s=a||await b()),s&&(o.Authorization=`Bearer ${s}`);let i={method:t,headers:o};n&&(i.body=JSON.stringify(n));try{let c=await fetch(`${z}${e}`,i);if(!c.ok){let l=`Error ${c.status}: ${c.statusText}`;try{l=(await c.clone().json().catch(()=>({}))).error||l}catch(g){console.error("Could not parse error response",g)}throw new Error(l)}if(t==="DELETE"||c.headers.get("content-length")==="0")return{success:!0};if(e==="/events")return c;if(c.headers.get("content-type")?.includes("application/json"))try{return await c.clone().json()}catch(l){console.error("JSON parsing error:",l,"for endpoint:",e);let g=await c.text();try{return g?JSON.parse(g):{success:!0}}catch(h){return console.error("Manual JSON parsing also failed:",h),{success:!0,text:g}}}else{let l=await c.text();if(!l)return{success:!0};try{return JSON.parse(l)}catch{return{success:!0,text:l}}}}catch(c){throw navigator.onLine?d(c.message,"error"):d("You're working offline. Some features may be limited.","info"),c}}async function Pn(e,t,n,a,o=!0){let s=await b(),i=o?`${e}${e.includes("?")?"&":"?"}size=thumb`:e,c=e;await fetch(i,{method:"GET",headers:{Authorization:`Bearer ${s}`}}).then(u=>{if(!u.ok)throw new Error("Image fetch failed");return u.blob()}).then(u=>{let l=URL.createObjectURL(u),g=document.getElementById(t);if(g){g.innerHTML="";let h=document.createElement("div");h.className="image-wrapper";let I=document.createElement("img");I.src=l,I.alt="User uploaded image",I.className="message-image",I.loading="lazy",I.setAttribute("onclick",`openImagePreview('${c}')`),h.appendChild(I);let O=r.messageCache.get(n);if(O?.author&&O.author.id===r.currentUser.id){let _=document.createElement("div");_.className="remove-image-btn",_.innerHTML="&times;",_.onclick=function(pe){pe.stopPropagation(),confirm("Remove this image?")&&lo(n,a)},h.appendChild(_)}g.appendChild(h)}}).catch(u=>{console.error("Error fetching image:",u);let l=document.getElementById(t);l&&(l.innerHTML='<div class="image-error">Failed to load image</div>')})}var v=w(()=>{"use strict";E();T();y();N();y();J()});async function me(e){try{return await r.storage.setItem("accessToken",e.accessToken),await r.storage.setItem("refreshToken",e.refreshToken),await r.storage.setItem("exp",Date.now()+e.exp*1e3),!0}catch(t){return console.error("Failed to save tokens:",t),!1}}async function Ao(){try{return{accessToken:await b(),refreshToken:await $o()}}catch(e){return console.error("Failed to get tokens:",e),null}}async function b(){return await r.storage.getItem("token")||await r.storage.getItem("accessToken")}async function $o(){return await r.storage.getItem("refreshToken")}async function Tr(){try{return await r.storage.removeItem("accessToken"),await r.storage.removeItem("refreshToken"),!0}catch(e){return console.error("Failed to clear tokens:",e),!1}}async function Lo(){let e=await Ao();return e?Date.now()>e.exp-10*1e3:!0}function Br(e){if(!e)return null;try{let n=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(n).split("").map(o=>`%${`00${o.charCodeAt(0).toString(16)}`.slice(-2)}`).join(""));return JSON.parse(a)}catch(t){return console.error("Failed to parse token:",t),null}}async function bo(){let{apiRequest:e}=await Promise.resolve().then(()=>(v(),U)),t=await b();if(!t)return;let{user:n}=await e("/auth/me","GET");if(!n)return;let a=Br(t);if(a)return{id:n.id,userName:n.userName,email:n.sub,isAdmin:n.isAdmin,lastLogin:a.lastLogin,metadata:a.metadata}}async function Na(e){let{apiRequest:t}=await Promise.resolve().then(()=>(v(),U));try{let n=await t("/auth/verify","POST",{email:e.email},e.token);return await me(n),n}catch(n){return console.error("Error while verifying token:",n),!1}}async function To(){let{apiRequest:e}=await Promise.resolve().then(()=>(v(),U)),t=await $o();if(!t)throw new Error("No refresh token available");try{let n=await e("/auth/refresh","POST",{refreshToken:t});if(!n.ok)throw new Error("Failed to refresh token");return await me(n),n}catch(n){throw await Tr(),n}}async function Ze(){let{apiRequest:e}=await Promise.resolve().then(()=>(v(),U)),{accessToken:t,refreshToken:n}=await Ao();if(!t||!n){Bo();return}await e("/auth/logout","POST",{refreshToken:n}).then(a=>{if(a.error)throw new Error("Failed to logout");Bo()})}async function Bo(){let{showToast:e}=await Promise.resolve().then(()=>(y(),F));localStorage.clear(),r.storage.clear(),r.storage=null,r.currentUser=null,r.messageEventSource&&(r.messageEventSource.close(),r.messageEventSource=null),r.tempIdMap=new Map,r.messageCache=new Map,r.unreadCounts=new Map,window.location="/",e("You have been signed out")}function Q(){return!1}function tt(){return pn()}async function Do(e,t){let{showToast:n,showLoading:a,hideLoading:o,showAppScreen:s,renderNewMagicLink:i}=await Promise.resolve().then(()=>(y(),F));if(!e||!e.trim()){n("Please enter your email","error");return}if(!un(e)){n("Email appears invalid. Please check the input.","error");return}if(oe.style.display==="block"&&Q()&&(!t||!t.trim())){n("Please enter your encryption password","error");return}try{if(a(),!await ie(V)){o(),n("Invalid encryption key","error");return}if(Q()||(oe.value=V),x==="dev")return await Ur(e);if(x==="magic-link"){if(Y())return await Ar();if(tt()){if(await Ra(t))return n("Successfully logged in!"),await s();n("Invalid password","error")}else await i(e)}if(x==="password"){let l=pt?.value,g=gt?.value,{emailParam:h,tokenParam:I,resetParam:O}=j();if(pt&&pt.offsetParent===null&&!h&&!I)return await Rr(e);if(h&&I&&O){if(!l||l.length<8){n("Password must be at least 8 characters","error"),o();return}if(l!==g){n("Passwords do not match","error"),o();return}return await Uo(h,I,l)}if(h&&I){if(!l||l.length<8){n("Password must be at least 8 characters","error"),o();return}if(l!==g){n("Passwords do not match","error"),o();return}return await Uo(h,I,l)}if(gt&&gt.offsetParent!==null){if(!l||l.length<8){n("Password must be at least 8 characters","error"),o();return}if(l!==g){n("Passwords do not match","error"),o();return}return await Dr(e,l)}if(!l){n("Please enter your password","error"),o();return}return await $r(e,l)}o()}catch(c){o(),n(c.message||"Failed to log in","error")}}async function Ur(e){let{apiRequest:t}=await Promise.resolve().then(()=>(v(),U)),{showToast:n,showAppScreen:a}=await Promise.resolve().then(()=>(y(),F)),o=await t("/auth/dev-login","POST",{email:e});return await r.storage.setItem("token",o.token),r.currentUser=o.user,n("Successfully logged in!"),await a()}async function Ar(){let{showToast:e,showAppScreen:t}=await Promise.resolve().then(()=>(y(),F));return await Pa(),e("Successfully logged in!"),await t()}async function $r(e,t){let{apiRequest:n}=await Promise.resolve().then(()=>(v(),U)),{showToast:a,showAppScreen:o}=await Promise.resolve().then(()=>(y(),F)),s=await n("/auth/password-login","POST",{email:e,password:t});if(s.error)throw new Error(s.error);return await me(s),a("Successfully logged in!"),await o()}async function Uo(e,t,n){let{apiRequest:a}=await Promise.resolve().then(()=>(v(),U)),{showToast:o,showAppScreen:s}=await Promise.resolve().then(()=>(y(),F)),i=await a("/auth/setup-password","POST",{email:e,token:t,password:n});if(i.error)throw new Error(i.error);return await me(i),o("Password set successfully!"),await s()}async function Dr(e,t){let{apiRequest:n}=await Promise.resolve().then(()=>(v(),U)),{showToast:a,showAppScreen:o}=await Promise.resolve().then(()=>(y(),F)),s=await n("/auth/register","POST",{email:e,password:t});if(s.error)throw new Error(s.error);return await me(s),a("Account created successfully!"),await o()}async function Rr(e){let{apiRequest:t}=await Promise.resolve().then(()=>(v(),U)),{hideLoading:n,renderPasswordResetSent:a}=await Promise.resolve().then(()=>(y(),F)),o=await t("/auth/request-password-reset","POST",{email:e});n(),a(o.message)}var N=w(()=>{"use strict";E();M();T();B();He();Et();vt()});E();M();N();J();Ye();ze();kt();gn();T();N();He();Et();Jn();y();Ke();async function Ro(){try{if(C(),Yn())try{return await Kn(),d("Successfully logged in!"),await Qe()}catch(e){return f(),d(e.message||"OAuth sign-in failed","error"),await W()}return Y()&&x!=="magic-link"&&x!=="password"&&(window.location="/"),Y()&&x==="password"?await W():Q()?await W():tt()?(await ie(),_t(),await Qe()):await W()}catch(e){return console.error("Error while checking if authenticated:",e),d("Failed to initialize the application","error"),f(),await W()}}Ke();Zn();aa();y();v();Nt();je();B();function Po(){window.openImagePreview=hn,window.addEventListener("online",async()=>{r.currentChannelId&&await ue(r.currentChannelId)}),window.addEventListener("DOMContentLoaded",async()=>{await Ro()}),document.addEventListener("click",()=>{cn.classList.remove("show")}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Gt()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&q.classList.contains("active")&&q.classList.remove("active")}),document.addEventListener("click",e=>{window.innerWidth<=768&&ct.classList.contains("open")&&!e.target.closest(".sidebar")&&!e.target.closest(".menu-toggle")&&ct.classList.remove("open")}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?r.messageEventSource&&(r.messageEventSource.close(),r.messageEventSource=null):document.visibilityState==="visible"&&!r.messageEventSource&&r.currentChannelId&&ue(r.currentChannelId)}),L?.addEventListener("click",()=>{let e=A.value.trim(),t=oe?oe.value?.trim():null;Do(e,t)}),Ea?.addEventListener("click",()=>Ze()),La?.addEventListener("click",async e=>{e.preventDefault();let{renderForgotPasswordView:t}=await Promise.resolve().then(()=>(y(),F));t()}),A?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),L.click())}),oe?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),L.click())}),an?.addEventListener("click",()=>{let e=H.value;oo(e)}),H?.addEventListener("keydown",e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),an.click())}),da?.addEventListener("click",()=>sa()),Zt?.addEventListener("click",async()=>{let e=fe.value.trim();e&&(await Nn(e),jt())}),fe?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Zt.click())}),la?.addEventListener("click",()=>jt()),ha?.addEventListener("click",async()=>{r.currentChannelForEdit&&confirm("Are you sure you want to delete this channel?")&&(await Fn(r.currentChannelForEdit.id),et())}),rn?.addEventListener("click",async()=>{let e=ne.value.trim();e&&r.currentChannelForEdit&&(await On(r.currentChannelForEdit.id,e),et())}),ne?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),rn.click())}),ua?.addEventListener("click",()=>et()),tn?.addEventListener("click",async()=>{let e=ae.value.trim();if(e&&r.currentMessageForEdit){if(r.currentMessageForEditIsThread){let{updateThreadReply:t}=await Promise.resolve().then(()=>(de(),ce));await t(r.currentMessageForEdit,e),r.currentMessageForEditIsThread=!1}else r.currentMessageForEditIsDM?(await Bt(r.currentMessageForEdit,e,r.currentMessageForEditImages||[]),r.currentMessageForEditIsDM=!1,r.currentMessageForEditImages=[]):await io(r.currentMessageForEdit,e);Wt()}}),ae?.addEventListener("keydown",e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),tn.click())}),ma?.addEventListener("click",()=>Wt()),ya?.addEventListener("click",async e=>{let t=e.target.closest(".reaction-item");if(t&&r.currentMessageForReaction){let n=t.dataset.reaction;await bt(r.currentMessageForReaction,n)}}),pa?.addEventListener("click",()=>ia()),va?.addEventListener("change",e=>{e.target.files.length>0&&(xt(e.target.files),e.target.value="")}),ga?.addEventListener("click",()=>{q.classList.remove("active");let e=D.getAttribute("data-object-url");e&&(URL.revokeObjectURL(e),D.removeAttribute("data-object-url"))}),p?.addEventListener("dragover",e=>{e.preventDefault(),p.classList.add("drag-over")}),p?.addEventListener("dragleave",()=>{p.classList.remove("drag-over")}),p?.addEventListener("drop",e=>{e.preventDefault(),p.classList.remove("drag-over"),e.dataTransfer.files.length>0&&xt(e.dataTransfer.files)}),p?.addEventListener("click",async e=>{let t=e.target.closest(".channel-link");if(t){e.preventDefault();let c=t.dataset.channelId,u=t.dataset.channelName;c&&await Te(c,u);return}let n=e.target.closest('.message-edit[data-is-dm="true"]');if(n){let c=n.dataset.messageId,u=e.target.closest(".message"),l=u?.querySelector(".message-text")?.textContent||"",g=[];u?.querySelectorAll(".message-image").forEach(h=>{h.dataset.image&&g.push(h.dataset.image)}),r.currentMessageForEdit=c,r.currentMessageForEditIsDM=!0,r.currentMessageForEditContent=l,r.currentMessageForEditImages=g,le({id:c,content:l,images:g});return}let a=e.target.closest('.message-delete[data-is-dm="true"]');if(a){let c=a.dataset.messageId;confirm("Are you sure you want to delete this message?")&&await In(c);return}let o=e.target.closest(".add-reaction[data-message-id]");if(o){let c=o.dataset.messageId;r.currentMessageForReaction=c,r.currentMessageForReactionIsDM=!0,Ve(c);return}let s=e.target.closest(".reaction[data-message-id]");if(s){let c=s.dataset.messageId,u=s.dataset.reaction;r.currentMessageForReactionIsDM=!0,_e(c,u)?await wn(c,u):await bt(c,u);return}let i=e.target.closest(".remove-image-btn[data-message-id]");if(i){e.stopPropagation();let c=i.dataset.messageId,u=i.dataset.image;if(confirm("Remove this image?")){let l=e.target.closest(".message"),g=[];l?.querySelectorAll(".message-image").forEach(I=>{I.dataset.image&&I.dataset.image!==u&&g.push(I.dataset.image)});let h=l?.querySelector(".message-text")?.textContent||"";await Bt(c,h,g)}return}}),dt?.addEventListener("click",async()=>{let e=!document.body.classList.contains("light-mode");await It(!e)}),Ia?.addEventListener("click",()=>{ct.classList.toggle("open")}),xa?.addEventListener("click",e=>{e.stopPropagation(),cn.classList.toggle("show")}),st?.addEventListener("click",()=>Qn()),fa?.addEventListener("click",()=>Ht()),sn?.addEventListener("click",async()=>{let e=ye.value.trim();e&&await ea(e)}),ye?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),sn.click())}),Ca?.addEventListener("click",()=>ta()),ka?.addEventListener("click",()=>zt()),ln?.addEventListener("click",async()=>{await na(we.value)}),we?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),ln.click())}),Yt?.addEventListener("click",async()=>{let e=ot.value.trim(),t=rt?.value?.trim()||"",n=document.querySelector('input[name="user-role"]:checked')?.value||"user";e&&(await yo(e,n,t||void 0),ot.value="",rt&&(rt.value=""))}),ot?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Yt.click())}),wa?.addEventListener("click",async()=>{if(confirm("Are you sure you want to leave this server?"))try{await m("/users/exit","POST"),await Ze()}catch(e){console.error("Error exiting server:",e)}}),Sa?.addEventListener("click",()=>jn()),ba?.addEventListener("click",()=>Pt()),Ua?.addEventListener("click",async()=>{let e=Aa?.value?.trim(),t=$a?.value;if(e&&t){let{createWebhook:n}=await Promise.resolve().then(()=>(Ot(),Ft));await n(e,t)}})}Po();})();
